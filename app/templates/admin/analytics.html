<!-- extend from base layout -->
{% extends "admin/base.html" %}

{% block head %}

<script src="/static/js/highcharts.js"></script>

{% endblock %}


{% block content %}

<h4>
{% if not current_user.country %}
    <a href="{{ url_for('admin_country_list') }}">Projects</a> >>
{% endif %}
<a href="{{ url_for('admin_country_item',slug=country.slug) }}">{{ country.name }}</a> >> Analytics
</h4>

<!--<img src="http://speckycdn.sdm.netdna-cdn.com/wp-content/uploads/2008/10/underconstruction3.gif"/>-->

<form action method="post" name="analytics" id="analytics">
<div class="row">	

<div class="small-6 columns">
From: <input type="text" id="start_date" name="start_date">
</div>
<div class="small-6 columns">
To: <input type="text" id="end_date" name="end_date">
</div>


</div>
<input class="button small" type="submit" value="Go">
</form>

<div class="row">

<div class="small-6 columns">

<h5>Policy Datasets</h5>
<table>
<tr><th>&nbsp;</th><th>Charts</th><th>Downloads</th></tr>
{% for item in stats_policy %}
	  <tr><td>{{ item.name }}</td><td class="center-text">{{ item.charts }}</td><td class="center-text">{{ item.downloads }}</td></tr>
{% endfor %}
</table>

{% if stats_budget|length > 0 %}

<h5>Budget Datasets</h5>
<table>
<tr><th>&nbsp;</th><th>Charts</th><th>Downloads</th></tr>
{% for item in stats_budget %}
	  <tr><td>{{ item.name }}</td><td class="center-text">{{ item.charts }}</td><td class="center-text">{{ item.downloads }}</td></tr>
{% endfor %}
</table>

{% endif %}

{% if stats_download|length > 0 %}

<h5>Download Only Datasets</h5>
<table>
<tr><th>&nbsp;</th><th>Downloads</th></tr>
{% for item in stats_download %}
	  <tr><td>{{ item.name }}</td><td class="center-text">{{ item.downloads }}</td></tr>
{% endfor %}
</table>

{% endif %}

</div>

<div class="small-6 columns">

<div id="pie"></div>

</div>

</div>

{% endblock %}

{% block scripts %}

var pieSlices =  {{ stats_majortopic | safe }};

$(function(){
  
	$('#start_date').fdatepicker({
		initialDate: '{{start_date}}',
		format: 'yyyy-mm-dd',
		disableDblClickSelection: true,
		leftArrow:'<<',
		rightArrow:'>>',
		closeIcon:'X',
		closeButton: true
	});
	
	$('#end_date').fdatepicker({
		initialDate: '{{end_date}}',
		format: 'yyyy-mm-dd',
		disableDblClickSelection: true,
		leftArrow:'<<',
		rightArrow:'>>',
		closeIcon:'X',
		closeButton: true
	});
	
	
  $( "#analytics" ).submit(function( event ) {
  
    if  ( new Date( $('#start_date').val() ) > new Date( $('#end_date').val() ) ) {
      alert("'To' is before 'From'");
      event.preventDefault();
    }
    
  });
	
	
  var pie = new Highcharts.Chart({
      chart: {
          renderTo: 'pie',
          plotBackgroundColor: null,
          plotBorderWidth: null,
          plotShadow: false,
          type: 'pie',
          height: 700
      },
      credits: {
          enabled: false
      },
      title: {
          text: ''
      },
      plotOptions: {
          pie: {
              allowPointSelect: false,
              dataLabels: {
                enabled: false
              },
              showInLegend: true
          }
      },
      legend: {
          layout: 'vertical',
      },
      series: [{
          name: 'Charts',
          colorByPoint: true,
          data: pieSlices
      }]
  });

	
});

{% endblock %}